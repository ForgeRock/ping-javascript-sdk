<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@forgerock/davinci-client | Documentation</title><meta name="description" content="Documentation for Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"><a href="https://github.com/yourusername/yourrepo">GitHub</a></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Documentation</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../index.html">Documentation</a></li><li><a href="_forgerock_davinci-client.html">@forgerock/davinci-client</a></li></ul><h1>Module @forgerock/davinci-client</h1></div><section class="tsd-panel tsd-typography"><a id="davinci-client" class="tsd-anchor"></a><h2 class="tsd-anchor-link">DaVinci Client<a href="#davinci-client" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is the DaVinci Client module for interacting with PingOne Application policies mapped to DaVinci flows. This module helps enable developers to write their own UI and UX for supporting DaVinci Flows within JavaScript &quot;SPA&quot; applications.</p>
<a id="install-and-import" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Install and import<a href="#install-and-import" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The DaVinci Client can be installed via npm:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@forgerock/davinci-client</span>
</code><button type="button">Copy</button></pre>

<p>Then, import the <code>davinci</code> module as a named import:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">davinci</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@forgerock/davinci-client&#39;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="create--configure-your-davinci-client" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Create &amp; configure your DaVinci Client<a href="#create--configure-your-davinci-client" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Configure DaVinci Client with the following minimum, required properties:</p>
<ol>
<li><code>clientId</code></li>
<li><code>wellknown</code></li>
</ol>
<pre><code class="ts"><span class="hl-5">// Demo with example values</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">davinci</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@forgerock/davinci&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">davinciClient</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">davinci</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">config:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">clientId:</span><span class="hl-1"> </span><span class="hl-2">&#39;726b47438-c41c-4d51-98b0-84a6b474350f9&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">serverConfig:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">wellknown:</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;https://auth.pingone.ca/02f919edfe-189a-4bc7-9d6c-a46b474347/as/.well-known/openid-configuration&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>If you have a need for more than one client, say you need to use two or more different PingOne OIDC Applications, you can create two clients, but this should be a rare need.</p>
<pre><code class="ts"><span class="hl-5">// Demo with example values</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">davinci</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@forgerock/davinci&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">firstDavinciClient</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">davinci</span><span class="hl-1">(</span><span class="hl-5">/** config 1 **/</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">secondDavinciClient</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">davinci</span><span class="hl-1">(</span><span class="hl-5">/** config 2 **/</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Here's a full configuration interface:</p>
<pre><code class="ts"><span class="hl-5">// Demo with optional properties and example values</span><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">DaVinciConfig</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">clientId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// required</span><br/><span class="hl-1">  </span><span class="hl-4">responseType</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// optional; default value: &#39;code&#39;</span><br/><span class="hl-1">  </span><span class="hl-4">scope</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// optional; default value: &#39;openid&#39;</span><br/><span class="hl-1">  </span><span class="hl-4">serverConfig</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">timeout</span><span class="hl-1">?: </span><span class="hl-8">number</span><span class="hl-1">; </span><span class="hl-5">// optional; default value: ?? (NOT IMPLEMENTED)</span><br/><span class="hl-1">    </span><span class="hl-4">wellknown</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// required</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="start-a-davinci-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Start a DaVinci flow<a href="#start-a-davinci-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Call the <code>start</code> method on the returned client API:</p>
<pre><code class="ts"><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">node</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>If the user is not authenticated, this will return a <strong>normalized</strong> <code>node</code> object from the initial response from DaVinci. The node will be one of four types:</p>
<ol>
<li><code>ContinueNode</code></li>
<li><code>SuccessNode</code></li>
<li><code>ErrorNode</code></li>
<li><code>FailureNode</code></li>
</ol>
<p>Below is a brief look at the &quot;interface&quot; or schema of this node object (some properties removed or abbreviated for brevity):</p>
<pre><code class="ts"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">NodeState</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">cache</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">client</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">action</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">description</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">name</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">collectors</span><span class="hl-1">?: (</span><span class="hl-8">SingleValueCollector</span><span class="hl-1"> | </span><span class="hl-8">ActionCollector</span><span class="hl-1">)[];</span><br/><span class="hl-1">    </span><span class="hl-4">status</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-8">null</span><span class="hl-1"> | {</span><br/><span class="hl-1">    </span><span class="hl-4">code</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> | </span><span class="hl-8">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">message</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">status</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">httpStatus</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">server</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">id</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">interactionId</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">interactionToken</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">eventName</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">session</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">status</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">status</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The <code>node</code> data is organized for clearer intention. Each response from DaVinci is saved in a cache, so the <code>cache.key</code> is to lookup the exact response from which this node was generated (more on this later).</p>
<p>The <code>server</code> prop just has the items necessary for building the request for the subsequent call to DaVinci, which should rarely be used by the application layer.</p>
<p>The <code>client</code> property is what the application developers will be using for their rendering instructions and data collection needs and status.</p>
<p>To detect the node type after receiving a response, it's best to have a <code>switch</code> or <code>if</code> condition checking the <code>status</code> property:</p>
<pre><code class="ts"><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">node</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><br/><span class="hl-3">switch</span><span class="hl-1"> (</span><span class="hl-4">node</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;continue&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">renderContinue</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">renderSuccess</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">renderError</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">default</span><span class="hl-1">: </span><span class="hl-5">// Handle failure type</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">renderFailure</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="rendering-the-collectors" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Rendering the Collectors<a href="#rendering-the-collectors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When receiving a <code>ContinueNode</code>, it will contain an object called a <code>collector</code>. These are instruction to request information from a user or browser environment. There are two types of collectors: <code>SingleValueCollector</code> and <code>ActionCollector</code>. Their interface looks like this:</p>
<pre><code class="ts"><span class="hl-5">// This covers collectors, like username or password, that require a single value</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">SingleValueCollector</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">category</span><span class="hl-1">: </span><span class="hl-2">&#39;SingleValueCollector&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">SingleValueCollectorTypes</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">input</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> | </span><span class="hl-8">number</span><span class="hl-1"> | </span><span class="hl-8">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">output</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">label</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span><br/><span class="hl-5">// This is a collector that is associated with an &quot;action&quot; (aka button), like submit or</span><br/><span class="hl-5">// initiating another flow, i.e. forgot password or register</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">ActionCollector</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">category</span><span class="hl-1">: </span><span class="hl-2">&#39;ActionCollector&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">ActionCollectorTypes</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">output</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">key</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">label</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">url</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Although you can access the collectors via object &quot;dot notation&quot;, we recommend using a dedicated method for getting the collectors specifically. This provides better typing and <code>undefined</code>/<code>null</code> handling.</p>
<p>To dynamically render the collectors as UI, the intention is to have a component for each collector type. When receiving a <code>node</code> from DaVinci, you will iterate through the array of collectors.</p>
<a id="singlevaluecollector" class="tsd-anchor"></a><h4 class="tsd-anchor-link">SingleValueCollector<a href="#singlevaluecollector" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Upon each collector in the array, some will need an <code>updater</code>, like the collectors in the category of <code>SingleValueCollector</code>:</p>
<pre><code class="ts"><span class="hl-5">// Example SingleValueCollector using the TextCollector</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">collectors</span><span class="hl-1"> = </span><span class="hl-4">davinci</span><span class="hl-1">.</span><span class="hl-0">collectors</span><span class="hl-1">();</span><br/><span class="hl-4">collectors</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">collector</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">collector</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-2">&#39;TextCollector&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">renderTextCollector</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">, </span><span class="hl-4">davinci</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Here, you can see the passing of the collector object along with its <code>update</code> method and the current <code>collector</code> as its argument.</p>
<p>Then, in the collector component, you would have something like this:</p>
<pre><code class="ts"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">renderTextCollector</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">, </span><span class="hl-4">updater</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// ... component logic</span><br/><br/><span class="hl-1">  </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">onClick</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">updater</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">target</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">// render code</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>It's worth noting that directly mutating the <code>node</code> object, <code>collectors</code> or any other properties will not alter the DaVinci Client's internal state. Internal data stored in the client is immutable and can only be updated using the provided APIs, not through property assignment.</p>
<a id="submitcollector" class="tsd-anchor"></a><h4 class="tsd-anchor-link">SubmitCollector<a href="#submitcollector" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>SubmitCollector</code> is associated with the submission of the current node and its collected values, requesting the next step in the flow. This collector does not have an update-like function. The collector is just for rendering a button.</p>
<pre><code class="ts"><span class="hl-5">// Example SubmitCollector mapping</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">collectors</span><span class="hl-1"> = </span><span class="hl-4">davinci</span><span class="hl-1">.</span><span class="hl-0">collectors</span><span class="hl-1">();</span><br/><span class="hl-4">collectors</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">collector</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">collector</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-2">&#39;SubmitCollector&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">renderSubmitCollector</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">collector</span><span class="hl-1">, </span><span class="hl-5">// This is the only argument you will need to pass</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>We will cover the associated action related to this collector in the next section: Continuing a DaVinci Flow below.</p>
<a id="flowcollector-changing-a-davinci-flow" class="tsd-anchor"></a><h4 class="tsd-anchor-link">FlowCollector (Changing a DaVinci flow)<a href="#flowcollector-changing-a-davinci-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If a user selects an alternative flow button, like Reset Password or Registration. This action is associated with a <code>FlowCollector</code>, which instructs the application to change from the current flow and start a new, different flow.</p>
<p>To do this, you call the <code>flow</code> method on the <code>davinciClient</code> passing the <code>key</code> property to identify the new flow. This returns a function you can call when the user interacts with it.</p>
<pre><code class="ts"><span class="hl-5">// Example FlowCollector mapping</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">collectors</span><span class="hl-1"> = </span><span class="hl-4">davinci</span><span class="hl-1">.</span><span class="hl-0">collectors</span><span class="hl-1">();</span><br/><span class="hl-4">collectors</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-4">collector</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">collector</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-2">&#39;FlowCollector&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">renderFlowCollector</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">, </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">flow</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<pre><code class="ts"><span class="hl-5">// Example FlowCollector Component</span><br/><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">renderFlowCollector</span><span class="hl-1">(</span><span class="hl-4">collector</span><span class="hl-1">, </span><span class="hl-4">startFlow</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">// ... component logic</span><br/><br/><span class="hl-1">  </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">onClick</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">startFlow</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">// render code</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="continuing-a-davinci-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Continuing a DaVinci flow<a href="#continuing-a-davinci-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After collecting the needed data, you proceed to the next node in the DaVinci flow by calling the <code>.next()</code> method on the same <code>davinci</code> client object. This can be the result of a user clicking on the button rendered from the <code>SubmitCollector</code>, from the &quot;submit&quot; event of the HTML form itself, or from programmatically triggering the submission in the application layer.</p>
<pre><code class="ts"><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">nextStep</span><span class="hl-1"> = </span><span class="hl-4">davinci</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Note: There's no need to pass anything into the <code>next</code> method as the DaVinci Client internally stores the updated object needed for the server.</p>
<p>Once the server responds, you will receive the same &quot;node&quot; that will be one of the four types discussed above. You will want to do the same conditional checks to render the appropriate UI.</p>
<a id="handling-an-error" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Handling an error<a href="#handling-an-error" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>An &quot;error&quot; in the DaVinci Client is caused by data that can be fixed and resubmitted. A few examples are an email value with an invalid format or a new password that is too short. This is different than a <code>failure</code>, which cannot be resubmitted; the flow has to be restarted (this will be covered later in this document).</p>
<p>When an error is received, hold on to the reference of the previous <code>node</code> as you'll need it to re-render the form. Use the previous <code>node</code> to render the form, and the <code>error</code> information on the new <code>ErrorNode</code>. Once the data has been revised, call <code>.next()</code> as you did before.</p>
<a id="a-completed-davinci-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">A completed DaVinci Flow<a href="#a-completed-davinci-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Once a flow is complete, it is of type <code>success</code> or <code>failure</code> and cannot be continued. Success means you have completed the flow and have received or updated a session and, usually, you have received an Authorization Code to complete an OAuth flow to collect an Access Token.</p>
<a id="handling-success" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Handling success<a href="#handling-success" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When you receive a success node, you will likely want to use the Authorization Code and other client data in order to complete an OAuth flow. To do this, you can pick the Authorization Code and State out of the client object and use them to call the <code>TokenManager.getTokens()</code> method from the JavaScript SDK.</p>
<p>Here's a brief sample of what that might look like in pseudocode:</p>
<pre><code class="ts"><span class="hl-5">// ... other imports</span><br/><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Config</span><span class="hl-1">, </span><span class="hl-4">TokenManager</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@forgerock/javascript-sdk&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// ... other config or initialization code</span><br/><br/><span class="hl-5">// This Config.set accepts the same config schema as the davinci function</span><br/><span class="hl-4">Config</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">node</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">();</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">node</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1"> === </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">clientInfo</span><span class="hl-1"> = </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">getClient</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">code</span><span class="hl-1"> = </span><span class="hl-4">clientInfo</span><span class="hl-1">.</span><span class="hl-4">authorization</span><span class="hl-1">?.</span><span class="hl-4">code</span><span class="hl-1"> || </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">state</span><span class="hl-1"> = </span><span class="hl-4">clientInfo</span><span class="hl-1">.</span><span class="hl-4">authorization</span><span class="hl-1">?.</span><span class="hl-4">state</span><span class="hl-1"> || </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tokens</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">TokenManager</span><span class="hl-1">.</span><span class="hl-0">getTokens</span><span class="hl-1">({ </span><span class="hl-4">query:</span><span class="hl-1"> { </span><span class="hl-4">code</span><span class="hl-1">, </span><span class="hl-4">state</span><span class="hl-1"> } });</span><br/><span class="hl-1">  </span><span class="hl-5">// user now has session and OIDC tokens</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="handling-a-failure" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Handling a failure<a href="#handling-a-failure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If you receive a <code>FailureNode</code>, you will not be able to continue and must restart a new DaVinci flow. Some examples of failures are DaVinci flow timeouts due to inactivity or server failures like a <code>5xx</code> type server error.</p>
<p>Here's what this looks like in code:</p>
<pre><code class="ts"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">node</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">next</span><span class="hl-1">();</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">node</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1"> === </span><span class="hl-2">&#39;failure&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> = </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">getError</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">renderError</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-5">// ... user clicks button to restart flow</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">freshNode</span><span class="hl-1"> = </span><span class="hl-4">davinciClient</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="contributing-guidelines" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Contributing guidelines<a href="#contributing-guidelines" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you'd like to contribute to this project, below are the internal dependencies, conventions and patterns used in the project. Please familiarize yourself with these guidelines and reach out if you have any questions.</p>
<a id="runtime-dependencies" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Runtime dependencies<a href="#runtime-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The only runtime-dependency within this project is <a href="https://redux-toolkit.js.org/introduction/getting-started">Redux Toolkit (aka RTK)</a> and its optional package <a href="https://redux-toolkit.js.org/rtk-query/overview">RTK Query</a>. These libraries act as the core to the library's network request, caching and state management functionality. Redux Toolkit's only dependency is <code>immer</code>, which is what provides the immutability feature without loss of ergonomics.</p>
<p>Regardless of the use of RTK, this implementation detail is to not leak out into the Public API used by the customer. This public API will be a thin abstraction that sits between the customer and the RTK implementation.</p>
<p>We use RTK in the following ways:</p>
<ol>
<li>Network query management: RTK Query</li>
<li>Cache management: RTK Query</li>
<li>Transformation logic: RTK Slice &amp; Reducers</li>
<li>Object access and type narrowing: RTK Selectors</li>
<li>Immutable state management: Immer from within RTK</li>
</ol>
<a id="developer-dependency" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Developer dependency<a href="#developer-dependency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The most important &quot;compile-time&quot; dependency is <a href="typescriptlang.org">TypeScript</a>. This assists in static code analysis and enforces types to help with code insights, autocomplete and assisted refactoring.</p>
<a id="conventions-and-patterns" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Conventions and patterns<a href="#conventions-and-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ol>
<li>&quot;Query API&quot;: this pattern is responsible for network requests to an API; handle error, success and failures; as well as cache the original response.</li>
<li>&quot;Slice&quot;: state slices represent &quot;normalized&quot; data that simplifies responses and derived data.</li>
<li>&quot;Reducers&quot;: these are simple functions that are specific to the Redex &quot;pattern&quot;, used to transform or &quot;map&quot; one source of data to a target source.</li>
<li>&quot;Utils&quot;: these are pure functions that are library agnostic, side-effect free.</li>
</ol>
</section><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Modules"><h2><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg> Modules</h2></summary><dl class="tsd-member-summaries"><dt class="tsd-member-summary"><a id="index" class="tsd-anchor"></a><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Module"><use href="../assets/icons.svg#icon-2"></use></svg><a href="_forgerock_davinci-client.index.html">index</a><a href="#index" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary"><a id="types" class="tsd-anchor"></a><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Module"><use href="../assets/icons.svg#icon-2"></use></svg><a href="_forgerock_davinci-client.types.html">types</a><a href="#types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd></dl></details></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#davinci-client"><span>Da<wbr/>Vinci <wbr/>Client</span></a><ul><li><a href="#install-and-import"><span>Install and import</span></a></li><li><a href="#create--configure-your-davinci-client"><span>Create &amp; configure your <wbr/>Da<wbr/>Vinci <wbr/>Client</span></a></li><li><a href="#start-a-davinci-flow"><span>Start a <wbr/>Da<wbr/>Vinci flow</span></a></li><li><a href="#rendering-the-collectors"><span>Rendering the <wbr/>Collectors</span></a></li><li><ul><li><a href="#singlevaluecollector"><span>Single<wbr/>Value<wbr/>Collector</span></a></li><li><a href="#submitcollector"><span>Submit<wbr/>Collector</span></a></li><li><a href="#flowcollector-changing-a-davinci-flow"><span>Flow<wbr/>Collector (<wbr/>Changing a <wbr/>Da<wbr/>Vinci flow)</span></a></li></ul></li><li><a href="#continuing-a-davinci-flow"><span>Continuing a <wbr/>Da<wbr/>Vinci flow</span></a></li><li><ul><li><a href="#handling-an-error"><span>Handling an error</span></a></li></ul></li><li><a href="#a-completed-davinci-flow"><span>A completed <wbr/>Da<wbr/>Vinci <wbr/>Flow</span></a></li><li><ul><li><a href="#handling-success"><span>Handling success</span></a></li><li><a href="#handling-a-failure"><span>Handling a failure</span></a></li></ul></li><li><a href="#contributing-guidelines"><span>Contributing guidelines</span></a></li><li><ul><li><a href="#runtime-dependencies"><span>Runtime dependencies</span></a></li><li><a href="#developer-dependency"><span>Developer dependency</span></a></li><li><a href="#conventions-and-patterns"><span>Conventions and patterns</span></a></li></ul></li></ul><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Modules"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Modules</summary><div><a href="#index" class=""><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Module"><use href="../assets/icons.svg#icon-2"></use></svg><span>index</span></a><a href="#types" class=""><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Module"><use href="../assets/icons.svg#icon-2"></use></svg><span>types</span></a></div></details></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/yourusername/yourrepo" class="tsd-nav-link">GitHub</a></nav><nav class="tsd-navigation"><a href="../index.html">Documentation</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer></footer><div class="overlay"></div></body></html>
